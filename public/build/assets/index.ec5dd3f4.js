import{I as z,M as H,T as J,B as K}from"./dividerClasses.e029716e.js";import{R as O,j as c,c as k,a as e,aq as b,r as W,b as T,a6 as X,a8 as Y,ar as Z,f as ee,F as A,as as C,L as oe,at as N}from"./app.db582371.js";import{b as B,g as re,c as se,a as P,u as te,o as ne,F as ae}from"./object.33151b62.js";import{F as j}from"./FormLabel.6b7faa27.js";import{u as ue,P as ie,e as R,a as le,M as q,B as ce}from"./index.ba2b0917.js";const de="_root_nlvn7_1",me="_title_nlvn7_5",pe="_container_nlvn7_13",_e="_button_nlvn7_22",fe="_btnText_nlvn7_34",he="_textContainer_nlvn7_38",ge="_item_nlvn7_65",l={root:de,title:me,container:pe,button:_e,btnText:fe,textContainer:he,item:ge},xe="_formControl_m7qws_1",Fe="_input_m7qws_5",w={formControl:xe,input:Fe},Ce="_formField_79zhx_1",we="_formPhoneField_79zhx_32",be="_suffix_79zhx_37",ye="_suffixDisabled_79zhx_47",ve="_selectField_79zhx_51",Ee="_field_79zhx_71",Ne="_formFieldError_79zhx_86",Be="_prefix_79zhx_94",g={formField:Ce,formPhoneField:we,suffix:be,suffixDisabled:ye,selectField:ve,field:Ee,formFieldError:Ne,prefix:Be},m=O.forwardRef(function({label:r,name:s,placeholder:d,error:n,type:i="text",readOnly:t,register:a,className:p,textarea:_=!1,onChange:f,onKeyUp:h,onBlur:y,onFocus:u,autocomplete:x,defaultValue:F,testId:D,formFieldsRef:I,max:U,min:Q,suffix:M,disabled:v,prefix:L,showError:V=!0},G){const E=B(),S=re(E==null?void 0:E.errors,`${s}.message`);return c("div",{ref:G,className:k(g.formField,p),children:[r&&e("b",{children:r}),c("div",{className:g.field,children:[L&&e("div",{className:g.prefix,children:L}),_?e("textarea",{onBlur:y,onChange:f,onFocus:u,onKeyUp:h,placeholder:d,name:s,ref:I?a&&a():a,defaultValue:F,"data-test-id":D,disabled:v,autoComplete:"off",id:s}):e("input",{...a(s),placeholder:d,type:i,name:s,readOnly:t,defaultValue:F,"data-test-id":D,max:U,min:Q,disabled:v,autoComplete:s,id:s}),M&&e("div",{className:k(g.suffix,{[g.suffixDisabled]:v}),children:M})]}),V&&(n||S)&&e("p",{className:g.formFieldError,"data-test-id":`${s}-error-message`,children:n||S})]})}),De=()=>{var n,i,t,a;const{control:o,register:r,formState:s,getValues:d}=B();return e("div",{className:w.formControl,children:c(j,{className:w.formControl,children:[e(m,{showError:!0,error:(i=(n=s.errors)==null?void 0:n.email)==null?void 0:i.message,autocomplete:!1,register:r,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(a=(t=s.errors)==null?void 0:t.password)==null?void 0:a.message,register:r,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"})]})})},Me=()=>{var s,d,n,i,t,a,p,_,f,h;const{register:o,formState:r}=B();return e("div",{className:w.formControl,children:c(j,{className:w.formControl,children:[e(m,{error:(d=(s=r.errors)==null?void 0:s.name)==null?void 0:d.message,autocomplete:!1,register:o,placeholder:"\u0418\u043C\u044F",name:"name"}),e(m,{error:(i=(n=r.errors)==null?void 0:n.phone)==null?void 0:i.message,register:o,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(a=(t=r.errors)==null?void 0:t.password)==null?void 0:a.message,register:o,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"}),e(m,{error:(_=(p=r.errors)==null?void 0:p.password_confirmation)==null?void 0:_.message,register:o,placeholder:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C",name:"password_confirmation",type:"password"}),e(m,{error:(h=(f=r.errors)==null?void 0:f.birthday)==null?void 0:h.message,register:o,type:"date",placeholder:"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F",name:"birthday"})]})})},Le=se().shape({phone:P().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),password:P().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C")}),Se=async o=>{const{data:r}=await b.post("/login",o);return r},$=async()=>{const{data:o}=await b.get("/user");return o},ze=async()=>{await b.post("/logout")},ke=async o=>{const{data:r}=await b.post("/register",o);return r};function $e(){ue("(max-width:768px)");const[o,r]=W.exports.useState("login"),s=T(X),{openAlert:d}=Y(),n=te({mode:"onBlur",resolver:ne(Le),defaultValues:{phone:"",password:""}}),i=T(Z),t=ee(),a={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:440,bgcolor:"#fff",boxShadow:24,p:4,borderRadius:"30px"},p=async u=>{try{await Se({...u,remember:!0}),t(N(await $())),t(C(!1))}catch(x){console.log(x),d("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u043E\u0439\u0442\u0438","error")}},_=async u=>{try{await ke({...u,remember:!0}),t(N(await $())),t(C(!1))}catch(x){for(const F in x.response.data.errors)n.setError(F,{message:x.response.data.errors[F][0]})}},f=async()=>{await ze()},h={login:"\u0412\u0445\u043E\u0434 \u0432 \u043B\u0438\u0447\u043D\u044B\u0439 \u043A\u0430\u0431\u0438\u043D\u0435\u0442",registration:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F"},y=()=>c(ae,{...n,children:[e(J,{className:l.title,id:"modal-modal-title",variant:"h6",component:"h2",children:h[o]}),e("div",{className:l.container,children:o==="login"?e(De,{}):e(Me,{})}),e(K,{onClick:n.handleSubmit(o==="login"?p:_),className:l.button,children:e("span",{className:l.btnText,children:o==="login"?"\u0412\u043E\u0439\u0442\u0438":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})}),o==="login"?c("div",{className:l.textContainer,children:[e("span",{children:"\u041D\u0435\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?"}),e("span",{onClick:()=>r("registration"),children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})]}):e("div",{className:l.textContainer,children:e("span",{onClick:()=>r("login"),children:"\u0412\u043E\u0439\u0442\u0438"})})]});return c(A,{children:[s?e(ie,{variant:"popover",popupId:"demo-popup-menu",children:u=>c(A,{children:[e("i",{...R.bindTrigger(u),className:l.root,children:e(z,{type:"profile"})}),c(le,{...R.bindMenu(u),children:[e(q,{onClick:u.close,children:e(oe,{href:"/",children:"\u0417\u0430\u043A\u0430\u0437\u044B"})}),e(q,{className:l.item,onClick:()=>{f(),t(N(null)),u.close()},children:"\u0412\u044B\u0439\u0442\u0438"})]})]})}):e("i",{onClick:()=>t(C(!0)),className:l.root,children:e(z,{type:"profile"})}),e(H,{open:i,onClose:()=>t(C(!1)),children:e(ce,{sx:a,children:y()})})]})}export{$e as default};
