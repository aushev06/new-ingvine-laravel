import{I as z,M as H,T as J,B as K}from"./dividerClasses.5b48aa25.js";import{R as O,j as c,c as k,a as e,aq as w,r as W,b as T,a6 as X,a8 as Y,ar as Z,f as ee,F as A,as as b,L as oe,at as v}from"./app.8881debb.js";import{b as B,g as re,c as se,a as P,u as te,o as ae,F as ue}from"./object.8568af8d.js";import{F as j}from"./FormLabel.d0206049.js";import{u as ne,P as ie,e as R,a as le,M as q,B as ce}from"./index.00da8cd5.js";const de="_root_8b25f_1",me="_title_8b25f_5",fe="_container_8b25f_13",pe="_button_8b25f_22",_e="_btnText_8b25f_34",he="_textContainer_8b25f_38",ge="_item_8b25f_65",l={root:de,title:me,container:fe,button:pe,btnText:_e,textContainer:he,item:ge},xe="_formControl_m7qws_1",Fe="_input_m7qws_5",C={formControl:xe,input:Fe},be="_formField_79zhx_1",Ce="_formPhoneField_79zhx_32",we="_suffix_79zhx_37",ye="_suffixDisabled_79zhx_47",Ee="_selectField_79zhx_51",Ne="_field_79zhx_71",ve="_formFieldError_79zhx_86",Be="_prefix_79zhx_94",g={formField:be,formPhoneField:Ce,suffix:we,suffixDisabled:ye,selectField:Ee,field:Ne,formFieldError:ve,prefix:Be},m=O.forwardRef(function({label:r,name:s,placeholder:d,error:a,type:i="text",readOnly:t,register:u,className:f,textarea:p=!1,onChange:_,onKeyUp:h,onBlur:y,onFocus:n,autocomplete:x,defaultValue:F,testId:D,formFieldsRef:I,max:U,min:Q,suffix:M,disabled:E,prefix:L,showError:V=!0},G){const N=B(),S=re(N==null?void 0:N.errors,`${s}.message`);return c("div",{ref:G,className:k(g.formField,f),children:[r&&e("b",{children:r}),c("div",{className:g.field,children:[L&&e("div",{className:g.prefix,children:L}),p?e("textarea",{onBlur:y,onChange:_,onFocus:n,onKeyUp:h,placeholder:d,name:s,ref:I?u&&u():u,defaultValue:F,"data-test-id":D,disabled:E,autoComplete:"off",id:s}):e("input",{...u(s),placeholder:d,type:i,name:s,readOnly:t,defaultValue:F,"data-test-id":D,max:U,min:Q,disabled:E,autoComplete:s,id:s}),M&&e("div",{className:k(g.suffix,{[g.suffixDisabled]:E}),children:M})]}),V&&(a||S)&&e("p",{className:g.formFieldError,"data-test-id":`${s}-error-message`,children:a||S})]})}),De=()=>{var a,i,t,u;const{control:o,register:r,formState:s,getValues:d}=B();return e("div",{className:C.formControl,children:c(j,{className:C.formControl,children:[e(m,{showError:!0,error:(i=(a=s.errors)==null?void 0:a.email)==null?void 0:i.message,autocomplete:!1,register:r,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(u=(t=s.errors)==null?void 0:t.password)==null?void 0:u.message,register:r,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"})]})})},Me=()=>{var s,d,a,i,t,u,f,p,_,h;const{register:o,formState:r}=B();return e("div",{className:C.formControl,children:c(j,{className:C.formControl,children:[e(m,{error:(d=(s=r.errors)==null?void 0:s.name)==null?void 0:d.message,autocomplete:!1,register:o,placeholder:"\u0418\u043C\u044F",name:"name"}),e(m,{error:(i=(a=r.errors)==null?void 0:a.phone)==null?void 0:i.message,register:o,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(u=(t=r.errors)==null?void 0:t.password)==null?void 0:u.message,register:o,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"}),e(m,{error:(p=(f=r.errors)==null?void 0:f.password_confirmation)==null?void 0:p.message,register:o,placeholder:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C",name:"password_confirmation",type:"password"}),e(m,{error:(h=(_=r.errors)==null?void 0:_.birthday)==null?void 0:h.message,register:o,type:"date",placeholder:"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F",name:"birthday"})]})})},Le=se().shape({phone:P().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),password:P().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C")}),Se=async o=>{const{data:r}=await w.post("/login",o);return r},$=async()=>{const{data:o}=await w.get("/user");return o},ze=async()=>{await w.post("/logout")},ke=async o=>{const{data:r}=await w.post("/register",o);return r};function $e(){ne("(max-width:768px)");const[o,r]=W.exports.useState("login"),s=T(X),{openAlert:d}=Y(),a=te({mode:"onBlur",resolver:ae(Le),defaultValues:{phone:"",password:""}}),i=T(Z),t=ee(),u={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:440,bgcolor:"#fff",boxShadow:24,p:4,borderRadius:"30px"},f=async n=>{try{await Se({...n,remember:!0}),t(v(await $())),t(b(!1))}catch(x){console.log(x),d("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u043E\u0439\u0442\u0438","error")}},p=async n=>{try{await ke({...n,remember:!0}),t(v(await $())),t(b(!1))}catch(x){for(const F in x.response.data.errors)a.setError(F,{message:x.response.data.errors[F][0]})}},_=async()=>{await ze()},h={login:"\u0412\u0445\u043E\u0434 \u0432 \u043B\u0438\u0447\u043D\u044B\u0439 \u043A\u0430\u0431\u0438\u043D\u0435\u0442",registration:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F"},y=()=>c(ue,{...a,children:[e(J,{className:l.title,id:"modal-modal-title",variant:"h6",component:"h2",children:h[o]}),e("div",{className:l.container,children:o==="login"?e(De,{}):e(Me,{})}),e(K,{onClick:a.handleSubmit(o==="login"?f:p),className:l.button,children:e("span",{className:l.btnText,children:o==="login"?"\u0412\u043E\u0439\u0442\u0438":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})}),o==="login"?c("div",{className:l.textContainer,children:[e("span",{children:"\u041D\u0435\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?"}),e("span",{onClick:()=>r("registration"),children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})]}):e("div",{className:l.textContainer,children:e("span",{onClick:()=>r("login"),children:"\u0412\u043E\u0439\u0442\u0438"})})]});return c(A,{children:[s?e(ie,{variant:"popover",popupId:"demo-popup-menu",children:n=>c(A,{children:[e("i",{...R.bindTrigger(n),className:l.root,children:e(z,{type:"profile"})}),c(le,{...R.bindMenu(n),children:[e(q,{onClick:n.close,children:e(oe,{href:"/",children:"\u0417\u0430\u043A\u0430\u0437\u044B"})}),e(q,{className:l.item,onClick:()=>{_(),t(v(null)),n.close()},children:"\u0412\u044B\u0439\u0442\u0438"})]})]})}):e("i",{onClick:()=>t(b(!0)),className:l.root,children:e(z,{type:"profile"})}),e(H,{open:i,onClose:()=>t(b(!1)),children:e(ce,{sx:u,children:y()})})]})}export{$e as default};
