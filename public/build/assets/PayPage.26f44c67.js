import{u as w,a3 as yu,a4 as fu,b as bu,d as Nu,r as t,a5 as Du,j as r,a as u,T as L,F as ou,f as j,a6 as iu,a7 as eu,a8 as Au,H as xu}from"./app.799907c0.js";import{M as Tu,S as Fu}from"./MainLayout.04ae91a3.js";import{s as e,A as Bu}from"./Pay.module.6077f9b2.js";import{c as _u,a as su,u as Pu,o as Iu}from"./object.ffecdedb.js";import{F as c,a as au}from"./FormLabel.addbaed4.js";import{T as f,O as wu}from"./TextField.a236ebf3.js";import{R as ru,F as v,a as y}from"./RadioGroup.7cc39e03.js";import{B as nu}from"./index.8d3b604b.js";import"./index.289286f0.js";import"./index.a24a7f52.js";import"./NavLink.279788c0.js";const Lu=_u().shape({name:su().required("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F"),phone:su().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")}),tu=1,ju=4,lu=window.location.search.includes("token"),ku=()=>{var k,R,S,U,V,O,$,Y,M,q,H,G,K,z,J,Q,W,X,Z,uu;const o=w(yu),n=w(fu),b=w(bu),B=Nu(),[_,N]=t.exports.useState(!0),{openAlert:h}=Du(),[P,E]=t.exports.useState(n==null?void 0:n.total),[i,d]=t.exports.useState(!1),[D,C]=t.exports.useState(""),[g,A]=t.exports.useState(""),[x,cu]=t.exports.useState(0),{register:T,handleSubmit:du,control:Su,formState:a,setValue:p,getValues:pu,setError:I}=Pu({mode:"onBlur",resolver:Iu(Lu),defaultValues:{name:o==null?void 0:o.name,phone:"",address:"",delivery_type:2,pay_type:1,city:b,street:"",house:"",entrance:"",apartment:"",coupon:""}}),[m,mu]=t.exports.useState({}),l=pu();t.exports.useEffect(()=>{o&&(p("name",o.name),p("phone",o.phone))},[o]),t.exports.useEffect(()=>{E(n==null?void 0:n.total)},[n]);const hu=()=>{eu.checkCoupon(D).then(s=>{E(s.data.resultSum),p("coupon",D),A("success")}).catch(()=>{A("error")})},Eu=()=>{const s=[];return l.delivery_type===tu||l.delivery_type===ju?(l.name||s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0418\u043C\u044F"),l.phone||s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")):(l.name||s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0418\u043C\u044F"),l.phone||s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),!lu&&!b&&(s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0440\u0430\u0439\u043E\u043D"),I("city",{message:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043E\u0440\u043E\u0434"})),l.street||(s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0443\u043B\u0438\u0446\u0443"),I("street",{message:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0443\u043B\u0438\u0446\u0443"})),l.house||(s.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0434\u043E\u043C"),I("house",{message:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0434\u043E\u043C"}))),s.length>0?(h(s[0],"error"),!1):!0},Cu=s=>{if(p("street",(s==null?void 0:s.address)||""),!s)return;mu(s);const F={headers:{"Content-Type":"application/json",Accept:"application/json"}};iu.get(`/api/taxi/get-delivery-sum?destination_latitude=${s.lat}&destination_longitude=${s.lon}`,{headers:F.headers}).then(vu=>{cu(vu.data.sum)})},gu=async s=>{if(!lu&&s.delivery_type!==tu&&(n==null?void 0:n.total)<500){h("\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430 \u043E\u0442 500 \u0440\u0443\u0431\u043B\u0435\u0439","error");return}if(!!Eu()){s.destination_longitude=m==null?void 0:m.lon,s.destination_latitude=m==null?void 0:m.lat;try{d(!0);const F=await eu.save(s);s.pay_type?window.location=F.data.redirect_url:(localStorage.setItem("token",new Date().getTime()),B(Au()),window.location="/success")}catch{}finally{d(!1)}}};return n?r(Tu,{disableCategories:!0,children:[u(L,{className:e.title,variant:"h1",children:"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430"}),r("div",{className:e.container,children:[r("div",{className:e.form,children:[u(L,{className:e.formTitle,variant:"h5",children:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),u(c,{className:e.formControl,children:u(f,{...T("name"),className:e.input,label:u("span",{className:e.label,children:"\u0418\u043C\u044F"}),variant:"filled",InputProps:{disableUnderline:!0},error:!!((R=(k=a==null?void 0:a.errors)==null?void 0:k.name)!=null&&R.message),helperText:(U=(S=a==null?void 0:a.errors)==null?void 0:S.name)==null?void 0:U.message})}),u(c,{className:e.formControl,children:u(f,{...T("phone"),className:e.input,label:u("span",{className:e.label,children:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"}),variant:"filled",InputProps:{disableUnderline:!0},error:!!((O=(V=a==null?void 0:a.errors)==null?void 0:V.name)!=null&&O.message),helperText:(Y=($=a==null?void 0:a.errors)==null?void 0:$.name)==null?void 0:Y.message})}),r("div",{className:e.line,children:[u("div",{children:r(c,{className:e.formControl,children:[u(au,{className:e.radioTitle,id:"demo-controlled-radio-buttons-group",children:"\u0421\u043F\u043E\u0441\u043E\u0431 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438"}),r(ru,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:`${l.delivery_type}`,onChange:s=>{p("delivery_type",+s.target.value),N(+s.target.value==2)},children:[u(v,{value:"2",control:u(y,{}),label:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),u(v,{value:"1",control:u(y,{}),label:"\u0421\u0430\u043C\u043E\u0432\u044B\u0432\u043E\u0437"}),u(v,{value:"4",control:u(y,{}),label:"\u041D\u0430 \u043C\u0435\u0441\u0442\u0435"})]})]})}),u("div",{children:r(c,{className:e.formControl,children:[u(au,{className:e.radioTitle,id:"demo-controlled-radio-buttons-group",children:"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"}),r(ru,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",defaultValue:`${l.pay_type}`,onChange:s=>{p("pay_type",+s.target.value)},children:[u(v,{value:"1",control:u(y,{}),label:"\u041E\u043D\u043B\u0430\u0439\u043D"}),u(v,{value:"0",control:u(y,{}),label:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u043C\u0438"})]})]})})]}),_&&r(ou,{children:[u(c,{children:u(Fu,{})}),r("div",{className:e.line,children:[u("div",{children:u(c,{className:e.formControl,children:u(Ru,{onSelect:Cu,address:l.street,error:!!((q=(M=a==null?void 0:a.errors)==null?void 0:M.street)!=null&&q.message),helperText:(G=(H=a==null?void 0:a.errors)==null?void 0:H.street)==null?void 0:G.message})})}),u("div",{children:u(c,{className:e.formControl,children:u(f,{...T("house"),error:!!((z=(K=a==null?void 0:a.errors)==null?void 0:K.house)!=null&&z.message),helperText:(Q=(J=a==null?void 0:a.errors)==null?void 0:J.house)==null?void 0:Q.message,className:j(e.input,e.apartment),label:u("span",{className:e.label,children:"\u0414\u043E\u043C/\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430"}),variant:"filled",InputProps:{disableUnderline:!0}})})})]}),u(c,{className:e.formControl,children:u(f,{...T("comment"),error:!!((X=(W=a==null?void 0:a.errors)==null?void 0:W.comment)!=null&&X.message),helperText:(uu=(Z=a==null?void 0:a.errors)==null?void 0:Z.comment)==null?void 0:uu.message,className:e.input,label:u("span",{className:e.label,children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0435"}),variant:"filled",InputProps:{disableUnderline:!0}})})]})]}),r("div",{className:e.info,children:[u(L,{className:e.formTitle,variant:"h5",children:"\u0412\u0430\u0448 \u0437\u0430\u043A\u0430\u0437"}),r("div",{children:[r("div",{className:e.item,children:[u("span",{children:"\u0422\u043E\u0432\u0430\u0440\u044B"}),r("span",{children:[(n==null?void 0:n.total)||0,"\u0440"]})]}),r("div",{className:e.item,children:[u("span",{children:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),r("span",{children:[x,"\u0440"]})]}),r("div",{className:j(e.item,e.total),children:[u("span",{children:"\u0418\u0442\u043E\u0433\u043E"}),u("span",{children:P+x})]}),r(c,{className:j(e.formControl,e.btnContainer),children:[u(wu,{onChange:s=>C(s.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u043A\u0435 \u043A\u0443\u043F\u043E\u043D",className:e.promoCode,variant:"filled",endAdornment:u(nu,{onClick:hu,className:e.btn,children:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"})}),r("div",{className:e.coupon,children:[g==="success"&&u("span",{className:e.success,children:"\u041A\u0443\u043F\u043E\u043D \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D"}),g==="error"&&u("span",{className:e.error,children:"\u041A\u0443\u043F\u043E\u043D \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D"})]})]}),u("div",{className:e.payContainer,children:u(nu,{disabled:i,onClick:du(gu),className:e.pay,children:"\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C"})})]})]})]})]}):null};function Ru({onSelect:o,address:n,error:b,helperText:B}){const[_,N]=t.exports.useState([]),[h,P]=t.exports.useState(null);t.exports.useEffect(()=>{E(n)},[n]);const E=i=>{h&&clearTimeout(h);const d=setTimeout(()=>{N([]);const D={headers:{"Content-Type":"application/json",Accept:"application/json"}};iu.get("/api/taxi/find-addresses?address="+i,{headers:D.headers}).then(C=>{const g=[];C.data.map((A,x)=>{x<=9&&g.push(A)}),N(g)}).catch(C=>{console.log(C.response)}).finally(()=>{})},500);P(d)};return u(Bu,{onChange:(i,d)=>{o(d)},options:_,getOptionLabel:i=>i.value,onInputChange:(i,d)=>{E(d)},renderInput:i=>u(f,{...i,label:u("span",{className:e.label,children:"\u0423\u043B\u0438\u0446\u0430"}),variant:"outlined",className:e.input,error:b,helperText:B})})}function Ju(o){return r(ou,{children:[u(xu,{title:"\u041E\u043F\u043B\u0430\u0442\u0430"}),u(ku,{})]})}export{Ju as default};
