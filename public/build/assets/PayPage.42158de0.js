import{u as I,a3 as gu,a4 as vu,b as yu,d as fu,r as l,a5 as bu,j as r,a as u,T as w,F as lu,f as j,a6 as ou,a7 as uu,a8 as Nu,H as Du}from"./app.0399bb32.js";import{M as Au,S as xu}from"./MainLayout.9d5f5a2b.js";import{s as e,A as Fu}from"./Pay.module.632b6e2c.js";import{c as Bu,a as eu,u as Tu,o as _u}from"./object.c789e4af.js";import{F as c,a as su}from"./FormLabel.b35a096d.js";import{T as g,O as Pu}from"./TextField.64e393da.js";import{R as au,F as x,a as F}from"./RadioGroup.77699ec8.js";import{B as ru}from"./index.9a3157e2.js";import"./index.871abcb3.js";import"./index.8e416753.js";import"./NavLink.f10d20ad.js";const Iu=Bu().shape({name:eu().required("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F"),phone:eu().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")}),nu=1,tu=window.location.search.includes("token"),wu=()=>{var k,L,U,V,$,R,S,M,O,q,H,Y,G,K,z,J,Q,W,X,Z;const o=I(gu),n=I(vu),v=I(yu),B=fu(),[T,y]=l.exports.useState(!0),{openAlert:m}=bu(),[_,h]=l.exports.useState(n==null?void 0:n.total),[i,d]=l.exports.useState(!1),[f,E]=l.exports.useState(""),[C,b]=l.exports.useState(""),[N,iu]=l.exports.useState(0),{register:D,handleSubmit:cu,control:ku,formState:s,setValue:p,getValues:du,setError:P}=Tu({mode:"onBlur",resolver:_u(Iu),defaultValues:{name:o==null?void 0:o.name,phone:"",address:"",delivery_type:2,pay_type:1,city:v,street:"",house:"",entrance:"",apartment:"",coupon:""}}),t=du();l.exports.useEffect(()=>{o&&(p("name",o.name),p("phone",o.phone))},[o]),l.exports.useEffect(()=>{h(n==null?void 0:n.total)},[n]);const pu=()=>{uu.checkCoupon(f).then(a=>{h(a.data.resultSum),p("coupon",f),b("success")}).catch(()=>{b("error")})},mu=()=>{const a=[];return t.delivery_type===nu?(t.name||a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0418\u043C\u044F"),t.phone||a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")):(t.name||a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0418\u043C\u044F"),t.phone||a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),!tu&&!v&&(a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0440\u0430\u0439\u043E\u043D"),P("city",{message:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043E\u0440\u043E\u0434"})),console.log(t.street),t.street||(a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0443\u043B\u0438\u0446\u0443"),P("street",{message:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0443\u043B\u0438\u0446\u0443"})),t.house||(a.push("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0443\u043A\u0430\u0437\u0430\u0442\u044C \u0434\u043E\u043C"),P("house",{message:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0434\u043E\u043C"}))),a.length>0?(m(a[0],"error"),!1):!0},hu=a=>{if(p("street",(a==null?void 0:a.address)||""),!a)return;const A={headers:{"Content-Type":"application/json",Accept:"application/json"}};ou.get(`/api/taxi/get-delivery-sum?destination_latitude=${a.lat}&destination_longitude=${a.lon}`,{headers:A.headers}).then(Cu=>{iu(Cu.data.sum)})},Eu=async a=>{if(!tu&&a.delivery_type!==nu&&(n==null?void 0:n.total)<500){m("\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430 \u043E\u0442 500 \u0440\u0443\u0431\u043B\u0435\u0439","error");return}if(!!mu())try{d(!0);const A=await uu.save(a);a.pay_type?window.location=A.data.redirect_url:(localStorage.setItem("token",new Date().getTime()),B(Nu()),window.location="/success")}catch{}finally{d(!1)}};return n?r(Au,{disableCategories:!0,children:[u(w,{className:e.title,variant:"h1",children:"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430"}),r("div",{className:e.container,children:[r("div",{className:e.form,children:[u(w,{className:e.formTitle,variant:"h5",children:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),u(c,{className:e.formControl,children:u(g,{...D("name"),className:e.input,label:u("span",{className:e.label,children:"\u0418\u043C\u044F"}),variant:"filled",InputProps:{disableUnderline:!0},error:!!((L=(k=s==null?void 0:s.errors)==null?void 0:k.name)!=null&&L.message),helperText:(V=(U=s==null?void 0:s.errors)==null?void 0:U.name)==null?void 0:V.message})}),u(c,{className:e.formControl,children:u(g,{...D("phone"),className:e.input,label:u("span",{className:e.label,children:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"}),variant:"filled",InputProps:{disableUnderline:!0},error:!!((R=($=s==null?void 0:s.errors)==null?void 0:$.name)!=null&&R.message),helperText:(M=(S=s==null?void 0:s.errors)==null?void 0:S.name)==null?void 0:M.message})}),r("div",{className:e.line,children:[u("div",{children:r(c,{className:e.formControl,children:[u(su,{className:e.radioTitle,id:"demo-controlled-radio-buttons-group",children:"\u0421\u043F\u043E\u0441\u043E\u0431 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438"}),r(au,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:`${t.delivery_type}`,onChange:a=>{p("delivery_type",+a.target.value),y(+a.target.value==2)},children:[u(x,{value:"2",control:u(F,{}),label:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),u(x,{value:"1",control:u(F,{}),label:"\u0421\u0430\u043C\u043E\u0432\u044B\u0432\u043E\u0437"})]})]})}),u("div",{children:r(c,{className:e.formControl,children:[u(su,{className:e.radioTitle,id:"demo-controlled-radio-buttons-group",children:"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B"}),r(au,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",defaultValue:`${t.pay_type}`,onChange:a=>{p("pay_type",+a.target.value)},children:[u(x,{value:"1",control:u(F,{}),label:"\u041E\u043D\u043B\u0430\u0439\u043D"}),u(x,{value:"0",control:u(F,{}),label:"\u041D\u0430\u043B\u0438\u0447\u043D\u044B\u043C\u0438"})]})]})})]}),T&&r(lu,{children:[u(c,{children:u(xu,{})}),r("div",{className:e.line,children:[u("div",{children:u(c,{className:e.formControl,children:u(ju,{onSelect:hu,address:t.street,error:!!((q=(O=s==null?void 0:s.errors)==null?void 0:O.street)!=null&&q.message),helperText:(Y=(H=s==null?void 0:s.errors)==null?void 0:H.street)==null?void 0:Y.message})})}),u("div",{children:u(c,{className:e.formControl,children:u(g,{...D("house"),error:!!((K=(G=s==null?void 0:s.errors)==null?void 0:G.house)!=null&&K.message),helperText:(J=(z=s==null?void 0:s.errors)==null?void 0:z.house)==null?void 0:J.message,className:j(e.input,e.apartment),label:u("span",{className:e.label,children:"\u0414\u043E\u043C/\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430"}),variant:"filled",InputProps:{disableUnderline:!0}})})})]}),u(c,{className:e.formControl,children:u(g,{...D("comment"),error:!!((W=(Q=s==null?void 0:s.errors)==null?void 0:Q.comment)!=null&&W.message),helperText:(Z=(X=s==null?void 0:s.errors)==null?void 0:X.comment)==null?void 0:Z.message,className:e.input,label:u("span",{className:e.label,children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0435"}),variant:"filled",InputProps:{disableUnderline:!0}})})]})]}),r("div",{className:e.info,children:[u(w,{className:e.formTitle,variant:"h5",children:"\u0412\u0430\u0448 \u0437\u0430\u043A\u0430\u0437"}),r("div",{children:[r("div",{className:e.item,children:[u("span",{children:"\u0422\u043E\u0432\u0430\u0440\u044B"}),r("span",{children:[(n==null?void 0:n.total)||0,"\u0440"]})]}),r("div",{className:e.item,children:[u("span",{children:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430"}),r("span",{children:[N,"\u0440"]})]}),r("div",{className:j(e.item,e.total),children:[u("span",{children:"\u0418\u0442\u043E\u0433\u043E"}),u("span",{children:_+N})]}),r(c,{className:j(e.formControl,e.btnContainer),children:[u(Pu,{onChange:a=>E(a.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u043A\u0435 \u043A\u0443\u043F\u043E\u043D",className:e.promoCode,variant:"filled",endAdornment:u(ru,{onClick:pu,className:e.btn,children:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"})}),r("div",{className:e.coupon,children:[C==="success"&&u("span",{className:e.success,children:"\u041A\u0443\u043F\u043E\u043D \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D"}),C==="error"&&u("span",{className:e.error,children:"\u041A\u0443\u043F\u043E\u043D \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D"})]})]}),u("div",{className:e.payContainer,children:u(ru,{disabled:i,onClick:cu(Eu),className:e.pay,children:"\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C"})})]})]})]})]}):null};function ju({onSelect:o,address:n,error:v,helperText:B}){const[T,y]=l.exports.useState([]),[m,_]=l.exports.useState(null);l.exports.useEffect(()=>{h(n)},[n]);const h=i=>{m&&clearTimeout(m);const d=setTimeout(()=>{y([]);const f={headers:{"Content-Type":"application/json",Accept:"application/json"}};ou.get("/api/taxi/find-addresses?address="+i,{headers:f.headers}).then(E=>{const C=[];E.data.map((b,N)=>{N<=9&&C.push(b)}),y(C)}).catch(E=>{console.log(E.response)}).finally(()=>{})},500);_(d)};return u(Fu,{onChange:(i,d)=>{o(d)},options:T,getOptionLabel:i=>i.value,onInputChange:(i,d)=>{h(d)},renderInput:i=>u(g,{...i,label:u("span",{className:e.label,children:"\u0423\u043B\u0438\u0446\u0430"}),variant:"outlined",className:e.input,error:v,helperText:B})})}function Gu(o){return r(lu,{children:[u(Du,{title:"\u041E\u043F\u043B\u0430\u0442\u0430"}),u(wu,{})]})}export{Gu as default};
