import{I as S,M as H,T as J,B as K}from"./dividerClasses.0dc0d412.js";import{R as O,j as c,c as z,a as e,aq as b,r as W,b as k,a6 as X,a8 as Y,ar as Z,f as ee,F as T,as as C,L as oe,at as v}from"./app.33f2b35d.js";import{b as B,g as re,c as se,a as A,u as te,o as ae,F as ue}from"./object.9c9d9aad.js";import{F as j}from"./FormLabel.fdcc143a.js";import{u as ne,P as ie,e as P,a as le,M as R,B as ce}from"./index.924466b5.js";const de="_root_14q5m_1",me="_title_14q5m_5",pe="_container_14q5m_13",_e="_button_14q5m_22",fe="_btnText_14q5m_34",he="_textContainer_14q5m_38",ge="_item_14q5m_65",l={root:de,title:me,container:pe,button:_e,btnText:fe,textContainer:he,item:ge},xe="_formControl_m7qws_1",Fe="_input_m7qws_5",w={formControl:xe,input:Fe},Ce="_formField_79zhx_1",we="_formPhoneField_79zhx_32",be="_suffix_79zhx_37",ye="_suffixDisabled_79zhx_47",Ee="_selectField_79zhx_51",Ne="_field_79zhx_71",ve="_formFieldError_79zhx_86",Be="_prefix_79zhx_94",g={formField:Ce,formPhoneField:we,suffix:be,suffixDisabled:ye,selectField:Ee,field:Ne,formFieldError:ve,prefix:Be},m=O.forwardRef(function({label:r,name:s,placeholder:d,error:a,type:i="text",readOnly:t,register:u,className:p,textarea:_=!1,onChange:f,onKeyUp:h,onBlur:y,onFocus:n,autocomplete:x,defaultValue:F,testId:q,formFieldsRef:I,max:U,min:Q,suffix:D,disabled:E,prefix:M,showError:V=!0},G){const N=B(),L=re(N==null?void 0:N.errors,`${s}.message`);return c("div",{ref:G,className:z(g.formField,p),children:[r&&e("b",{children:r}),c("div",{className:g.field,children:[M&&e("div",{className:g.prefix,children:M}),_?e("textarea",{onBlur:y,onChange:f,onFocus:n,onKeyUp:h,placeholder:d,name:s,ref:I?u&&u():u,defaultValue:F,"data-test-id":q,disabled:E,autoComplete:"off",id:s}):e("input",{...u(s),placeholder:d,type:i,name:s,readOnly:t,defaultValue:F,"data-test-id":q,max:U,min:Q,disabled:E,autoComplete:s,id:s}),D&&e("div",{className:z(g.suffix,{[g.suffixDisabled]:E}),children:D})]}),V&&(a||L)&&e("p",{className:g.formFieldError,"data-test-id":`${s}-error-message`,children:a||L})]})}),qe=()=>{var a,i,t,u;const{control:o,register:r,formState:s,getValues:d}=B();return e("div",{className:w.formControl,children:c(j,{className:w.formControl,children:[e(m,{showError:!0,error:(i=(a=s.errors)==null?void 0:a.email)==null?void 0:i.message,autocomplete:!1,register:r,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(u=(t=s.errors)==null?void 0:t.password)==null?void 0:u.message,register:r,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"})]})})},De=()=>{var s,d,a,i,t,u,p,_,f,h;const{register:o,formState:r}=B();return e("div",{className:w.formControl,children:c(j,{className:w.formControl,children:[e(m,{error:(d=(s=r.errors)==null?void 0:s.name)==null?void 0:d.message,autocomplete:!1,register:o,placeholder:"\u0418\u043C\u044F",name:"name"}),e(m,{error:(i=(a=r.errors)==null?void 0:a.phone)==null?void 0:i.message,register:o,placeholder:"+7 ___ ___ __ __",name:"phone"}),e(m,{error:(u=(t=r.errors)==null?void 0:t.password)==null?void 0:u.message,register:o,placeholder:"\u041F\u0430\u0440\u043E\u043B\u044C",name:"password",type:"password"}),e(m,{error:(_=(p=r.errors)==null?void 0:p.password_confirmation)==null?void 0:_.message,register:o,placeholder:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C",name:"password_confirmation",type:"password"}),e(m,{error:(h=(f=r.errors)==null?void 0:f.birthday)==null?void 0:h.message,register:o,type:"date",placeholder:"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F",name:"birthday"})]})})},Me=se().shape({phone:A().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),password:A().required("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C")}),Le=async o=>{const{data:r}=await b.post("/login",o);return r},$=async()=>{const{data:o}=await b.get("/user");return o},Se=async()=>{await b.post("/logout")},ze=async o=>{const{data:r}=await b.post("/register",o);return r};function $e(){ne("(max-width:768px)");const[o,r]=W.exports.useState("login"),s=k(X),{openAlert:d}=Y(),a=te({mode:"onBlur",resolver:ae(Me),defaultValues:{phone:"",password:""}}),i=k(Z),t=ee(),u={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:440,bgcolor:"#fff",boxShadow:24,p:4,borderRadius:"30px"},p=async n=>{try{await Le({...n,remember:!0}),t(v(await $())),t(C(!1))}catch(x){console.log(x),d("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u043E\u0439\u0442\u0438","error")}},_=async n=>{try{await ze({...n,remember:!0}),t(v(await $())),t(C(!1))}catch(x){for(const F in x.response.data.errors)a.setError(F,{message:x.response.data.errors[F][0]})}},f=async()=>{await Se()},h={login:"\u0412\u0445\u043E\u0434 \u0432 \u043B\u0438\u0447\u043D\u044B\u0439 \u043A\u0430\u0431\u0438\u043D\u0435\u0442",registration:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F"},y=()=>c(ue,{...a,children:[e(J,{className:l.title,id:"modal-modal-title",variant:"h6",component:"h2",children:h[o]}),e("div",{className:l.container,children:o==="login"?e(qe,{}):e(De,{})}),e(K,{onClick:a.handleSubmit(o==="login"?p:_),className:l.button,children:e("span",{className:l.btnText,children:o==="login"?"\u0412\u043E\u0439\u0442\u0438":"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})}),o==="login"?c("div",{className:l.textContainer,children:[e("span",{children:"\u041D\u0435\u0442 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?"}),e("span",{onClick:()=>r("registration"),children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})]}):e("div",{className:l.textContainer,children:e("span",{onClick:()=>r("login"),children:"\u0412\u043E\u0439\u0442\u0438"})})]});return c(T,{children:[s?e(ie,{variant:"popover",popupId:"demo-popup-menu",children:n=>c(T,{children:[e("i",{...P.bindTrigger(n),className:l.root,children:e(S,{type:"profile"})}),c(le,{...P.bindMenu(n),children:[e(R,{onClick:n.close,children:e(oe,{href:"/",children:"\u0417\u0430\u043A\u0430\u0437\u044B"})}),e(R,{className:l.item,onClick:()=>{f(),t(v(null)),n.close()},children:"\u0412\u044B\u0439\u0442\u0438"})]})]})}):e("i",{onClick:()=>t(C(!0)),className:l.root,children:e(S,{type:"profile"})}),e(H,{open:i,onClose:()=>t(C(!1)),children:e(ce,{sx:u,children:y()})})]})}export{$e as default};
